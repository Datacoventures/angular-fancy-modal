/**
 * angular-fancy-modal - the definitive modal/popup/dialog solution for AngularJS.
 * @author Alessandro Arnodo
 * @url http://alessandro.arnodo.net
 * @version v0.1.0
 * @link https://github.com/vesparny/angular-fancy-modal
 * @license MIT
 */
!function(e,n){"use strict";e.module("vesparny.fancyModal",[]).provider("$fancyModal",function(){var o=this.defaults={templateUrl:"",template:"<div></div>",resolve:{},controller:"",scope:"",showCloseButton:!0,closeOnEscape:!0,closeOnOverlayClick:!0,overlay:!0,theme:"fancymodal-theme-classic",openingClass:"fancymodal-content-opening",closingClass:"fancymodal-content-closing",openingOverlayClass:"fancymodal-overlay-opening",closingOverlayClass:"fancymodal-overlay-closing",bodyClass:"fancymodal-open"};this.setDefaults=function(n){e.extend(this.defaults,n)},this.$get=["$controller","$timeout","$rootScope","$injector","$compile","$http","$templateCache","$window","$document","$q",function(t,a,l,i,s,r,c,d,f,m){function u(e){27===e.keyCode&&k()}function v(){var e=n.createElement("div");e.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",n.body.appendChild(e);var o=e.offsetWidth-e.clientWidth;return n.body.removeChild(e),o}function p(){return M[0].scrollHeight>d.innerHeight}function y(e){var n=m.defer();return e.templateUrl?r.get(e.templateUrl,{cache:c}).then(function(e){n.resolve(e.data)}):n.resolve(e.template),n.promise}function h(n){var o=[];return e.forEach(n,function(e){o.push(m.when(i.invoke(e)))}),o}function C(e){var n=e.attr("id");e.scope().$destroy(),e.remove(),E=!1,0===w&&(M.removeClass("fancymodal-open"),j.css("margin-right","")),l.$emit("fancymodal.closed",n.substring(n.indexOf("-")+1))}function g(n){var o=e.element(n),t=o.data("options");if(E=!0,o.unbind("click"),1===w&&f.unbind("keydown"),w-=1,A){var a=e.element(n.children[0]);if(t.overlay){var l=e.element(n.children[0]);l.addClass(t.closingOverlayClass),a=e.element(n.children[1])}a.unbind(D).bind(D,function(){a.remove(),C(o)}).removeClass(t.openingClass).addClass(t.closingClass)}else C(o)}function $(){var o=n.querySelectorAll(".fancymodal");e.forEach(o,function(e){g(e)})}function b(n){function a(n){var o=e.element(n.target).hasClass("fancymodal-overlay"),t=e.element(n.target).hasClass("fancymodal-close");(o&&r.closeOnOverlayClick||t)&&k(d.attr("id"))}function i(n){var o,a=m.defer();return y(r).then(function(e){return o=e,m.all(h(r.resolve))}).then(function(i){if(E)a.reject();else{var f,m={},u=0;e.forEach(r.resolve,function(e,n){m[n]=i[u],u+=1}),c.$modal=n,m.$scope=c,r.controller&&(f=t(r.controller,m)),$.append(s(o)(c)),l.$emit("fancymodal.opened",d),a.resolve()}}),a.promise}var r=e.copy(o);n=n||{},e.extend(r,n),w+=1,O+=1,M.addClass(r.bodyClass),p()&&j.css("margin-right",v()+"px");var c=(r.scope||l).$new(),d=e.element('<div id="fancymodal-'+O+'" class="fancymodal"></div>').addClass(r.theme);d.data("options",r);var C=e.element("<div>").addClass("fancymodal-content");if(r.showCloseButton){var g=e.element("<div>").addClass("fancymodal-close");C.append(g)}r.closeOnEscape&&f.bind("keydown",u);var $=e.element("<div>").addClass("fancymodal-data");if(r.overlay){var b=e.element("<div>").addClass("fancymodal-overlay").addClass(r.openingOverlayClass);d.append(b)}C.append($),C.addClass(r.openingClass),d.bind("click",a),d.append(C),M.append(d);var x={id:O,close:function(){return k(O)}},A=i(x);return e.extend({opened:A},x)}function k(e){var o=n.getElementById(e);o?g(o):$()}var w=0,O=0,E=!1,x=(n.body||n.documentElement).style,A=e.isDefined(x.animation)||e.isDefined(x.WebkitAnimation)||e.isDefined(x.MozAnimation)||e.isDefined(x.MsAnimation)||e.isDefined(x.OAnimation),D="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",M=e.element(n).find("body"),j=e.element(n).find("html");return{open:function(e){return b(e)},close:function(e){return k(e)},getDefaults:function(){return e.copy(o)}}}]}).directive("fancyModal",["$fancyModal",function(n){return{restrict:"A",link:function(o,t,a){var l,i;t.on(a.trigger||"click",function(){i=n.getDefaults(),e.forEach(Object.keys(i),function(n){e.isDefined(a[n])&&(i[n]="true"===a[n]?!0:"false"===a[n]?!1:a[n])}),l=n.open(i)}),o.$on("$destroy",function(){l?l.opened.then(function(){l.close(),l=null}):l=null,i=null})}}}])}(angular,document,window);